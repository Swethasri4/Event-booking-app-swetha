<div class="preferences-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <mat-icon>tune</mat-icon>
        Event Category Preferences
      </mat-card-title>
      <mat-card-subtitle>
        Select the event categories you're interested in to filter your calendar view
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <div class="category-selection">
        <mat-grid-list cols="3" rowHeight="200px" gutterSize="16px">
          <mat-grid-tile *ngFor="let category of categories">
            <mat-card 
              class="category-card"
              [class.selected]="isSelected(category.id)"
              (click)="toggleCategory(category.id)">
              <mat-card-content>
                <div class="category-icon" [style.background-color]="category.color">
                  <mat-icon>event</mat-icon>
                </div>
                <h3>{{ category.name }}</h3>
                <p>{{ category.description }}</p>
                <mat-icon class="check-icon" *ngIf="isSelected(category.id)">check_circle</mat-icon>
              </mat-card-content>
            </mat-card>
          </mat-grid-tile>
        </mat-grid-list>
      </div>

      <div class="selection-summary" *ngIf="selectedCategoryIds.size > 0">
        <mat-chip-set>
          <mat-chip *ngFor="let cat of categories" [style.background-color]="isSelected(cat.id) ? cat.color : 'transparent'">
            {{ cat.name }}
          </mat-chip>
        </mat-chip-set>
      </div>
    </mat-card-content>

    <mat-card-actions>
      <button 
        mat-raised-button 
        color="primary" 
        (click)="savePreferences()"
        [disabled]="loading">
        <mat-icon *ngIf="!loading">save</mat-icon>
        <mat-spinner *ngIf="loading" diameter="20"></mat-spinner>
        {{ loading ? 'Saving...' : 'Save Preferences' }}
      </button>
      <button mat-button routerLink="/calendar">
        <mat-icon>calendar_today</mat-icon>
        Go to Calendar
      </button>
    </mat-card-actions>
  </mat-card>
</div>
